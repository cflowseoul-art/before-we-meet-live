# 📄 [SPEC] 1:3 개인별 맞춤 매칭 리포트 시스템 (V3.0)

## 1. 개요
* **목적**: 경매(내적 가치관)와 피드(외적 취향) 데이터를 정밀 분석하여 최적의 대화 상대 3인을 추천.
* **핵심 가치**: 데이터 기반의 객관적 확신 + 감성적 톤앤매너를 통한 아이스브레이킹 유도.
* **가중치 모델**: 가치관(Auction) 70% : 외적 취향(Feed) 30% 하이브리드 시스템.

---

## 2. 매칭 알고리즘 (Matching Logic)

추천 순위는 아래의 3단계 레이어 연산을 통해 결정됩니다.

### 2.1. [내면] 가치관 정합성 (Auction Score - 70%)
단순 입찰 여부를 넘어 **'관심의 희소성'**을 반영합니다.
* **희소 가중치**: 대중적인 아이템보다 입찰 인원수가 적은 아이템에서 일치했을 때 더 높은 점수를 부여합니다.
* **공식**: Σ (Min(A입찰가, B입찰가) / 해당 아이템 총 입찰 인원수) → 70점 만점 환산.
* **의미**: "남들이 보지 않는 곳을 함께 바라보는 두 사람"의 정합성 측정.

### 2.2. [외면] 시각적 호감도 (Visual Score - 30%)
하트 개수에 따른 단순 비례가 아닌 **'선택의 집중도'**를 반영합니다.
* **지수형 배점**: 3장 모두 선택한 유저에게 폭발적인 가산점을 부여합니다.
    * 1장: 5점 (긍정적 첫인상)
    * 2장: 15점 (강렬한 이끌림)
    * 3장: 30점 (완벽한 취향 일치)
* **공식**: 30 * (선택한 하트 수 / 3)^1.5

### 2.3. [시너지] 상호 보너스 (Synergy Multiplier)
* **Mutual Like (상호 호감)**: 유저 A와 B가 서로의 사진을 선택한 경우, 최종 점수에 **1.5배 가중치**를 부여하며 리포트 1순위로 강제 고정합니다.
* **조화 평균 적용**: 내면(경매)과 외면(피드) 점수가 균형 있게 높을 때 추가 시너지 점수를 부여합니다.

---

## 3. 리포트 상세 구성 (UI/UX)

### 3.1. 도입부: 당신의 갤러리 정체성 (Identity)
* **텍스트**: `{user_name}님을 위한 세 명의 특별한 인연`
* **비주얼**: 유저 본인의 메인 피드 사진 전시 (Google Drive API 연동) 및 핵심 가치관 키워드 워드클라우드 노출.

### 3.2. 파트너 카드: 선정된 3인의 페르소나
각 카드별로 데이터 기반의 다른 페르소나와 멘트를 할당합니다.

#### [Partner 1: 영혼의 파트너 (The Soulmate)]
* **선정 기준**: 종합 매칭 스코어 1위 유저.
* **멘트**: "가장 추천드리는 파트너는 **{matching_name}**님입니다. 가치관과 취향의 교차점이 **{match_rate}%**로 가장 높습니다."
* **상세**: "{core_value}"를 중시하는 {user_name}님과 생각의 결이 가장 비슷한 분입니다.

#### [Partner 2: 시각적 취향 저격 (The Visual High)]
* **선정 기준**: Visual Score(30%) 만점 혹은 최상위 유저.
* **멘트**: "**{matching_name}**님은 {user_name}님이 선택하신 사진 속 분위기와 가장 닮은 분이에요."
* **상세**: 서로의 미소에 이끌린 두 분, 사진 너머의 더 깊은 이야기를 나눠보시는 건 어떨까요?

#### [Partner 3: 공통의 고집 (The Hidden Link)]
* **선정 기준**: 희소 가치관 아이템에서 공통으로 고액 배팅을 한 유저.
* **멘트**: "**{matching_name}**님과는 **{common_item}**이라는 특별한 연결고리가 있네요!"
* **상세**: 전체 참가자 중 단 몇 분만이 관심을 가졌던 {common_item}에 두 분 모두 진심이셨습니다.

---

## 4. 데이터베이스 및 API 설계

### 4.1. 테이블 확장 및 관리
* `users` 테이블: `core_value`(핵심 가치), `interests`(관심사), `description`(감성 키워드) 추가.
* `final_reports`: 리포트 확정 시 스냅샷 데이터(JSON) 저장하여 결과 고정.

### 4.2. 리포트 생성 프로세스 (Logic)
1. 관리자가 [결과 발표] 클릭 시 `feed_likes`와 `auction_bids` 전수 조사.
2. 유저별 가중치 합산 스코어 연산 (Edge Function 활용 권장).
3. 상위 3인 페르소나 매칭 후 `final_reports` 테이블에 Insert.

---

## 5. 비기능적 요구사항 및 디자인 가이드
* **이미지 렌더링**: Google Drive API를 통한 고화질 썸네일 노출 및 최적화.
* **공유 기능**: `html2canvas`를 활용해 "Match Report"를 이미지 파일(PNG)로 저장 기능 제공.
* **톤앤매너**: 
    - 데이터는 **객관적(숫자, %)**으로 제시하되, 설명은 **주관적/감성적**으로 풀이.
    - Deep Navy & Gold 테마의 '갤러리 도슨트' 컨셉 적용.
    - 상대방 지칭 시 항상 '님'을 붙이고 긍정적인 형용사 활용 필수.